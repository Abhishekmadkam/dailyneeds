<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Tools</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
</head>

<body class="container py-4">

<h2 class="mb-3">PDF Tools</h2>
<p class="text-muted">Merge, split, and compress PDFs directly in your browser.</p>

<hr>

<h5>ðŸ”— Merge PDFs</h5>
<input type="file" id="mergeFiles" multiple accept="application/pdf" class="form-control mb-2">
<button class="btn btn-primary" onclick="mergePDFs()">Merge & Download</button>

<hr>

<h5>âœ‚ Split PDF</h5>
<input type="file" id="splitFile" accept="application/pdf" class="form-control mb-2">
<input type="number" id="pageNum" class="form-control mb-2" placeholder="Page number to extract">
<button class="btn btn-warning" onclick="splitPDF()">Split Page</button>

<hr>

<h5>ðŸ“‰ Compress PDF</h5>
<input type="file" id="compressFile" accept="application/pdf" class="form-control mb-2">
<button class="btn btn-success" onclick="compressPDF()">Compress & Download</button>

<p id="status" class="mt-3 fw-bold"></p>

<script>
const { PDFDocument } = PDFLib;

async function mergePDFs(){
  const files = document.getElementById('mergeFiles').files;
  if(files.length < 2) return alert("Select at least 2 PDFs");

  const merged = await PDFDocument.create();
  for(const file of files){
    const bytes = await file.arrayBuffer();
    const pdf = await PDFDocument.load(bytes);
    const pages = await merged.copyPages(pdf, pdf.getPageIndices());
    pages.forEach(p => merged.addPage(p));
  }

  downloadPDF(await merged.save(), "merged.pdf");
}

async function splitPDF(){
  const file = document.getElementById('splitFile').files[0];
  const pageNum = parseInt(document.getElementById('pageNum').value) - 1;
  if(!file || pageNum < 0) return alert("Invalid input");

  const bytes = await file.arrayBuffer();
  const pdf = await PDFDocument.load(bytes);
  const newPdf = await PDFDocument.create();
  const [page] = await newPdf.copyPages(pdf, [pageNum]);
  newPdf.addPage(page);

  downloadPDF(await newPdf.save(), "split.pdf");
}

async function compressPDF(){
  const file = document.getElementById('compressFile').files[0];
  if(!file) return alert("Select a PDF");

  const bytes = await file.arrayBuffer();
  const pdf = await PDFDocument.load(bytes, { ignoreEncryption: true });
  downloadPDF(await pdf.save({ useObjectStreams: true }), "compressed.pdf");
}

function downloadPDF(bytes, name){
  const blob = new Blob([bytes], { type: "application/pdf" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
}
</script>

</body>
</html>
